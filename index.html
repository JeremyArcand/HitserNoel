<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Hitster No√´l</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --red: #b63830;
      --dark-red: #8e2923;
      --green: #1f7a4d;
      --bg: #fdf7ec;
      --card-bg: #ffffff;
    }

    * { box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      text-align: center;
      margin: 0;
      padding: 24px 12px 40px;
      min-height: 100vh;
      color: var(--red);
      background: radial-gradient(circle at top, #ffe7de 0, #fdf7ec 45%, #e8f4ef 100%);
    }

    h1 {
      font-size: 2rem;
      margin: 4px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    h2 {
      font-size: 1.1rem;
      margin: 0 0 18px;
      color: #7f8c8d;
    }

    #card {
      max-width: 520px;
      margin: 0 auto;
      padding: 22px 18px 26px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.12);
      position: relative;
      overflow: hidden;
    }

    /* Progression */
    #game-progress-container { margin-bottom: 10px; }
    #game-progress-bar {
      width: 100%; max-width: 380px; height: 12px;
      background: #ecf0f1; border-radius: 999px;
      margin: 0 auto 5px auto;
      overflow: hidden;
    }
    #game-progress-fill {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--green), #27ae60);
      transition: width 0.25s ease-out;
    }
    #game-progress-label { font-size: 0.95rem; color: #7f8c8d; }

    /* Input rounds */
    #rounds-container {
      margin: 8px auto 10px;
      font-size: 0.9rem; color: #7f8c8d;
      display: flex; justify-content: center; align-items: center; gap: 6px;
      flex-wrap: wrap;
    }
    #rounds-container span { font-weight: 600; color: var(--red); }
    #round-count-input {
      width: 70px; padding: 4px 8px; border-radius: 999px;
      border: 1px solid #dcdcdc; font-size: 0.9rem; text-align: center;
    }

    /* Difficult√© */
    #difficulty-container {
      margin: 6px auto 14px;
      font-size: 0.9rem; color: #7f8c8d;
      display: flex; flex-wrap: wrap;
      gap: 6px 10px; justify-content: center;
    }
    #difficulty-container span { font-weight: 600; color: var(--red); }

    #difficulty-container label { display: flex; align-items: center; gap: 4px; cursor: pointer; }
    #difficulty-container input[type="radio"] { accent-color: var(--red); }

    #round-label { font-size: 1.3rem; font-weight: 600; margin-bottom: 4px; }
    #duration-label { margin-top: 2px; font-size: 0.95rem; color: #7f8c8d; }

    /* Barre audio */
    #progress-container { margin-top: 16px; margin-bottom: 6px; text-align: center; }
    #progress-bar {
      width: 100%; max-width: 380px; height: 9px;
      background: #ecf0f1; border-radius: 999px;
      margin: 0 auto; overflow: hidden;
    }
    #progress-fill {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--red), var(--dark-red));
      transition: width 0.12s linear;
    }
    #time-label { font-size: 0.9rem; color: #7f8c8d; margin-top: 6px; }

    /* Volume */
    #volume-control {
      margin-top: 14px; display: flex; justify-content: center;
      align-items: center; gap: 10px;
    }
    #volume-slider { width: 160px; }
    #volume-icon { font-size: 1.3rem; cursor: pointer; }

    audio { margin-top: 8px; width: 100%; max-width: 380px; }

    .buttons {
      margin-top: 20px;
      display: flex; flex-direction: column; gap: 10px;
      align-items: stretch;
    }

    button {
      border: none; padding: 11px 18px;
      border-radius: 999px; font-size: 1rem; cursor: pointer;
      background: var(--red); color: white;
      min-width: 180px; font-weight: 500;
      box-shadow: 0 3px 8px rgba(0,0,0,0.18);
    }
    button.secondary { background: #ecf0f1; color: var(--red); }

    .hidden { display: none !important; }

    /* Players */
    #players-section { margin-top: 22px; border-top: 1px solid #ecf0f1; padding-top: 16px; }
    #players-list { display: flex; flex-direction: column; gap: 6px; max-height: 200px; overflow-y: auto; }

    .player-row {
      display: flex; justify-content: space-between; align-items: center;
      background: #f8f4f1; border-radius: 10px;
      padding: 6px 8px; gap: 6px;
    }

    .player-buttons button { padding: 5px 9px; font-size: 0.8rem; }

    /* Podium */
    #podium-section { margin-top: 18px; border-top: 1px dashed #ecf0f1; padding-top: 10px; }
    .podium-line { padding: 4px 6px; border-radius: 8px; }
    .podium-1 { background: rgba(241,196,15,0.18); font-weight: 700; }
    .podium-2 { background: rgba(189,195,199,0.18); font-weight: 600; }
    .podium-3 { background: rgba(205,127,50,0.18); font-weight: 500; }

    /* Modal r√®glements */
    #rules-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex; justify-content: center; align-items: center;
      padding: 16px; z-index: 1000;
    }

    #rules-dialog {
      background: #fff; border-radius: 16px;
      max-width: 420px; width: 100%;
      padding: 18px; color: #333;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }

    #rules-dialog h3 { text-align: center; color: var(--red); }
    #rules-dialog ul { padding-left: 20px; }
  </style>
</head>

<body>
  <h1>üéÑ Hitster No√´l üéÑ</h1>
  <h2>Mode al√©atoire</h2>

  <div id="card">

    <!-- PROGRESSION -->
    <div id="game-progress-container">
      <div id="game-progress-bar"><div id="game-progress-fill"></div></div>
      <div id="game-progress-label">0 / 25 chansons</div>
    </div>

    <!-- CHOIX NOMBRE DE ROUNDS -->
    <div id="rounds-container">
      <span>Chansons dans la partie :</span>
      <input type="number" id="round-count-input" min="1" max="25" value="25">
    </div>

    <!-- DIFFICULT√â -->
    <div id="difficulty-container">
      <span>Niveau :</span>
      <label><input type="radio" name="difficulty" value="easy" checked> Facile</label>
      <label><input type="radio" name="difficulty" value="medium"> Moyen</label>
      <label><input type="radio" name="difficulty" value="hard"> Difficile</label>
      <label><input type="radio" name="difficulty" value="extreme"> Extr√™me</label>
    </div>

    <div id="round-label">Chanson 1</div>
    <div id="duration-label">Dur√©e : --:--</div>

    <!-- BARRE AUDIO -->
    <div id="progress-container">
      <div id="progress-bar"><div id="progress-fill"></div></div>
      <div id="time-label">0:00 / 0:00</div>
    </div>

    <!-- VOLUME -->
    <div id="volume-control">
      <span id="volume-icon">üîä</span>
      <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1">
    </div>

    <audio id="player"></audio>

    <!-- BOUTONS -->
    <div class="buttons">
      <button id="new-song-btn">Nouvelle chanson al√©atoire</button>
      <button id="play-btn">‚ñ∂Ô∏è Jouer</button>
      <button id="reveal-btn" class="secondary">R√©v√©ler</button>
    </div>

    <div id="answer" class="hidden">
      Titre : <span id="answer-title"></span><br>
      Artiste : <span id="answer-artist"></span>
    </div>

    <!-- JOUEURS -->
    <div id="players-section">
      <h3>Joueurs</h3>
      <div id="add-player">
        <input type="text" id="player-name-input" placeholder="Nom du joueur">
        <button id="add-player-btn">Ajouter</button>
      </div>
      <div id="players-list"></div>
    </div>

    <!-- PODIUM -->
    <div id="podium-section" class="hidden">
      <h3>üèÜ Podium</h3>
      <div id="podium-content"></div>
    </div>

    <!-- R√àGLEMENTS -->
    <button id="rules-btn" class="secondary">R√®glements</button>

  </div>

  <!-- POPUP -->
  <div id="rules-modal" class="hidden">
    <div id="rules-dialog">
      <h3>R√®glements du jeu</h3>
      <ul>
        <li>Choisir le nombre de chansons</li>
        <li>Ajouter les joueurs</li>
        <li>Deviner la chanson</li>
        <li>R√©v√©ler pour v√©rifier</li>
        <li>Attribuer les points (+1 / -1)</li>
      </ul>
      <button id="rules-close" class="secondary">Fermer</button>
    </div>
  </div>

<script>
/* === SONGS ‚Äî 25 TITRES === */
const songs = [
  { file: "01_all_i_want.mp3", title: "All I Want for Christmas Is You", artist: "Mariah Carey" },
  { file: "02_last_christmas.mp3", title: "Last Christmas", artist: "Wham!" },
  { file: "03_jingle_bell_rock.mp3", title: "Jingle Bell Rock", artist: "Bobby Helms" },
  { file: "04_santa_tell_me.mp3", title: "Santa Tell Me", artist: "Ariana Grande" },
  { file: "05_underneath_the_tree.mp3", title: "Underneath the Tree", artist: "Kelly Clarkson" },
  { file: "06_mistletoe.mp3", title: "Mistletoe", artist: "Justin Bieber" },
  { file: "07_snowman.mp3", title: "Snowman", artist: "Sia" },
  { file: "08_santa_s_coming_for_us.mp3", title: "Santa's Coming for Us", artist: "Sia" },
  { file: "09_its_beginning.mp3", title: "It's Beginning to Look a Lot Like Christmas", artist: "Michael Bubl√©" },
  { file: "10_rockin_around.mp3", title: "Rockin' Around the Christmas Tree", artist: "Brenda Lee" },
  { file: "11_most_wonderful.mp3", title: "It's the Most Wonderful Time of the Year", artist: "Andy Williams" },
  { file: "12_wonderful_christmastime.mp3", title: "Wonderful Christmastime", artist: "Paul McCartney" },
  { file: "13_happy_xmas.mp3", title: "Happy Xmas (War Is Over)", artist: "John Lennon" },
  { file: "14_step_into_christmas.mp3", title: "Step Into Christmas", artist: "Elton John" },
  { file: "15_feliz_navidad.mp3", title: "Feliz Navidad", artist: "Jos√© Feliciano" },
  { file: "16_let_it_snow.mp3", title: "Let It Snow", artist: "Dean Martin" },
  { file: "17_the_christmas_song.mp3", title: "The Christmas Song", artist: "Nat King Cole" },
  { file: "18_here_comes_santa_clause.mp3", title: "Here Comes Santa Claus", artist: "Gene Autry" },
  { file: "19_silver_bells.mp3", title: "Silver Bells", artist: "Dean Martin" },
  { file: "20_make_it_to_christmas.mp3", title: "Make It to Christmas", artist: "Alessia Cara" },
  { file: "21_a_holly_jolly_christmas.mp3", title: "A Holly Jolly Christmas", artist: "Burl Ives" },
  { file: "22_christmas.mp3", title: "Christmas (Baby Please Come Home)", artist: "Mariah Carey" },

  /* CHANSONS AJOUT√âES */
  { file: "23_blue_christmas.mp3", title: "Blue Christmas", artist: "Elvis Presley" },
  { file: "24_frosty_the_snowman.mp3", title: "Frosty the Snowman", artist: "Michael Bubl√©" },
  { file: "25_happy_xmas_celine.mp3", title: "Happy Xmas (War Is Over)", artist: "C√©line Dion" }
];

/* ELEMENTS */
const audio = document.getElementById("player");
const playBtn = document.getElementById("play-btn");
const newSongBtn = document.getElementById("new-song-btn");
const revealBtn = document.getElementById("reveal-btn");

const roundLabel = document.getElementById("round-label");
const durationLabel = document.getElementById("duration-label");
const progressFill = document.getElementById("progress-fill");
const timeLabel = document.getElementById("time-label");

const roundsInput = document.getElementById("round-count-input");

const answerDiv = document.getElementById("answer");
const answerTitle = document.getElementById("answer-title");
const answerArtist = document.getElementById("answer-artist");

const difficultyRadios = document.querySelectorAll('input[name="difficulty"]');

const playersListDiv = document.getElementById("players-list");
const addPlayerBtn = document.getElementById("add-player-btn");
const playerNameInput = document.getElementById("player-name-input");

const gameProgressLabel = document.getElementById("game-progress-label");
const gameProgressFill = document.getElementById("game-progress-fill");

const podiumSection = document.getElementById("podium-section");
const podiumContent = document.getElementById("podium-content");

/* R√àGLEMENTS */
const rulesBtn = document.getElementById("rules-btn");
const rulesModal = document.getElementById("rules-modal");
const rulesClose = document.getElementById("rules-close");

rulesBtn.addEventListener("click", () => rulesModal.classList.remove("hidden"));
rulesClose.addEventListener("click", () => rulesModal.classList.add("hidden"));
rulesModal.addEventListener("click", (e) => { if (e.target === rulesModal) rulesModal.classList.add("hidden"); });

/* LOGIQUE */
let difficulty = "easy";
let currentSongIndex = null;
let isPlaying = false;

let segmentStart = 0;
let segmentEnd = 0;
let fadeInterval = null;

let playedCount = 0;
let maxRounds = songs.length;
let remainingIndexes = songs.map((_, i) => i);

/* JOUEURS */
let players = [];

function renderPlayers() {
  playersListDiv.innerHTML = "";
  players.forEach((p) => {
    const row = document.createElement("div");
    row.className = "player-row";

    const main = document.createElement("div");
    main.innerHTML = `<span>${p.name}</span> <span>${p.score} pts</span>`;

    const btns = document.createElement("div");
    btns.className = "player-buttons";

    const plus = document.createElement("button");
    plus.textContent = "+1";
    plus.onclick = () => { p.score++; renderPlayers(); };

    const minus = document.createElement("button");
    minus.textContent = "-1";
    minus.onclick = () => { p.score = Math.max(0, p.score - 1); renderPlayers(); };

    btns.appendChild(plus);
    btns.appendChild(minus);
    row.appendChild(main);
    row.appendChild(btns);
    playersListDiv.appendChild(row);
  });
}

addPlayerBtn.addEventListener("click", () => {
  const name = playerNameInput.value.trim();
  if (!name) return;
  players.push({ name, score: 0 });
  playerNameInput.value = "";
  renderPlayers();
});
playerNameInput.addEventListener("keydown", e => { if (e.key === "Enter") addPlayerBtn.click(); });

/* Difficult√© */
difficultyRadios.forEach(r => r.addEventListener("change", () => difficulty = r.value));

function getClipLength() {
  if (difficulty === "medium") return 12;
  if (difficulty === "hard") return 7;
  if (difficulty === "extreme") return 3;
  return null;
}

/* Rounds */
roundsInput.addEventListener("input", () => {
  if (playedCount > 0) return;
  let val = parseInt(roundsInput.value);
  if (val < 1) val = 1;
  if (val > songs.length) val = songs.length;
  maxRounds = val;
  roundsInput.value = val;
  updateProgress();
});

function updateProgress() {
  gameProgressLabel.textContent = `${playedCount} / ${maxRounds} chansons`;
  gameProgressFill.style.width = `${(playedCount / maxRounds) * 100}%`;
}

/* Audio */
audio.addEventListener("timeupdate", () => {
  if (!audio.duration) return;
  let elapsed = audio.currentTime - segmentStart;
  let total = segmentEnd - segmentStart;

  if (elapsed >= total) {
    audio.pause();
    isPlaying = false;
    playBtn.textContent = "‚ñ∂Ô∏è Rejouer";
    audio.currentTime = segmentStart;
    return;
  }

  progressFill.style.width = (elapsed / total * 100) + "%";
  timeLabel.textContent = formatTime(elapsed) + " / " + formatTime(total);
});

function formatTime(s) {
  s = Math.floor(s);
  return Math.floor(s / 60) + ":" + String(s % 60).padStart(2, "0");
}

function computeSegment() {
  let full = audio.duration;
  let len = getClipLength();

  if (!len || len >= full) {
    segmentStart = 0;
    segmentEnd = full;
  } else {
    let maxStart = full - len;
    segmentStart = Math.random() * maxStart;
    segmentEnd = segmentStart + len;
  }
}

function playWithFade(reset) {
  if (reset) audio.currentTime = segmentStart;
  audio.volume = 0;
  audio.play();
  isPlaying = true;
  playBtn.textContent = "‚è∏Ô∏è Pause";

  let step = 0;
  fadeInterval = setInterval(() => {
    step++;
    audio.volume = Math.min(1, step / 20);
    if (step >= 20) clearInterval(fadeInterval);
  }, 40);
}

function pickRandomSong(autoPlay = false) {
  if (playedCount >= maxRounds) return endGame();
  if (remainingIndexes.length === 0) return endGame();

  let pos = Math.floor(Math.random() * remainingIndexes.length);
  let index = remainingIndexes[pos];
  remainingIndexes.splice(pos, 1);

  currentSongIndex = index;
  const s = songs[index];

  playedCount++;
  updateProgress();

  roundLabel.textContent = `Chanson ${playedCount}`;
  answerDiv.classList.add("hidden");

  audio.src = s.file;
  audio.load();

  audio.onloadedmetadata = () => {
    computeSegment();
    audio.currentTime = segmentStart;
    durationLabel.textContent = `Dur√©e : ${formatTime(segmentEnd - segmentStart)}`;
    timeLabel.textContent = `0:00 / ${formatTime(segmentEnd - segmentStart)}`;
    if (autoPlay) playWithFade(false);
  };
}

function endGame() {
  audio.pause();
  newSongBtn.disabled = true;
  playBtn.disabled = true;
  revealBtn.disabled = true;

  roundLabel.textContent = "Partie termin√©e üéâ";
  durationLabel.textContent = "Merci d'avoir jou√© !";

  podiumContent.innerHTML = "";
  let sorted = [...players].sort((a, b) => b.score - a.score);

  sorted.forEach((p, i) => {
    let div = document.createElement("div");
    div.className = `podium-line podium-${i + 1}`;
    div.textContent = `${i + 1}·µâ : ${p.name} ‚Äî ${p.score} pts`;
    podiumContent.appendChild(div);
  });

  podiumSection.classList.remove("hidden");
}

/* BOUTONS */
newSongBtn.addEventListener("click", () => pickRandomSong(true));

playBtn.addEventListener("click", () => {
  if (!audio.src) return pickRandomSong(true);

  if (!isPlaying) playWithFade(false);
  else {
    audio.pause();
    isPlaying = false;
    playBtn.textContent = "‚ñ∂Ô∏è Reprendre";
  }
});

revealBtn.addEventListener("click", () => {
  if (currentSongIndex === null) return;
  const s = songs[currentSongIndex];
  answerTitle.textContent = s.title;
  answerArtist.textContent = s.artist;
  answerDiv.classList.remove("hidden");
});

/* INIT */
maxRounds = songs.length;
updateProgress();
audio.volume = 1;
</script>

</body>
</html>
